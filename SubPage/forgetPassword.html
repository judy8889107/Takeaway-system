<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>忘記密碼</title>
    <!-- 引用jquery -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script>
        $(document).ready(function(){
            var validCode;
            $("#forgetPasswordFrom").submit(function(e){
                    var form = $(this);
                    var url = form.attr('action');
                    $t = 30; /* 30秒才能傳送一次驗證碼 */
                    $("#submit").prop("disabled",true);
                    $("#submit").attr("value","重新傳送("+String($t)+")");
                    
                    var interval = setInterval(function(){
                        $t -=1;
                        if($t == 0){
                            $("#submit").prop("disabled",false);
                            $("#submit").attr("value","重新傳送");
                            clearInterval(interval);
                        }else{
                            $str = "重新傳送("+String($t)+")";
                            $("#submit").attr("value",$str);
                        }
                        
                    },1000);
                    // 提交表單
                    $.ajax({
                        type: "POST",
                        url: url,
                        dataType:"text", //接收text資料
                        data: form.serialize(), // serializes the form's elements.
                        success: function(data)
                        {
                            var data = data== "false"? false:data; /* 判斷後台是回傳false(找不到用戶資料)或驗證碼 */
                            if(!data) alert("找不到該用戶資料，請重新輸入");
                            else{
                                validCode = data;
                                // alert(validCode); /* 測試用顯示驗證碼 */
                                $("#inputCodeSubmit").prop("disabled",false); /* 啟用確認鍵 */
                                $("#validCode").val(validCode); /* 傳送隱藏資料 */
                            }
                           
                        }
                    });
                    
                    e.preventDefault(); // avoid to execute the actual submit of the form.
            })

            $("#inputCodeSubmit").click(function(){
                $inputCode = $("input[name='inputCode']").val();
                // 若輸入一致則加載後台php，且跳回首頁
                if(validCode == $inputCode){
                    alert("輸入成功，即將跳轉至首頁");
                    $("body").load("../phpCode/verifyValidCode.php"); /* 加載後台session */
                    $(location).prop("href", "../SubPage/HomePage.html"); /* 登入成功跳轉首頁 */
                }
                else alert("驗證碼不一致，請重新嘗試!!");
            });

        })
    </script>
</head>
<body>
    <form id="forgetPasswordFrom" action="../phpCode/fogetPassword.php">
        <label>請輸入您的帳號/手機號碼/電子郵件，我們將發送驗證碼至您的信箱</label><br/>
        帳號/手機號碼/電子郵件：<input type="text" name="userName" maxlength="50" required/>
        <input id="submit" type="submit" name="submit" value="傳送認證信至您的電子信箱"/><br/>
    
    <!-- <form id="inputCodeForm" action="../phpCode/verifyValidCode.php"> -->
        認證碼：<input name="inputCode" type="text"><br/>
        <input id="validCode" name="validCode" type="hidden" value="">
        <input id="inputCodeSubmit" type="button" value="確認" disabled="true"/><br/>
    <!-- </form> -->
    </form>
    
    
</body>
</html>
